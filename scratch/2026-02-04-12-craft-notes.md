# Craft Session Notes — 2026-02-04-12 (Session 4)

**Session start:** 12:47 UTC

---

## Phase 0: Existing Work Check

### Recent PRs (to avoid duplication):
- **PR #22** (OPEN): polish/storage-error-handling — error propagation, tests
- **PR #21** (OPEN): polish/remove-dead-llm-module — removes llm.rs
- **PR #20** (OPEN): polish/runtime-module-cleanup — module visibility

### Work to avoid:
- Storage error handling (done)
- Runtime module organization (done)
- Dead code removal (done)

---

## Phase 1: Project Understanding

Key principle from VISION.md: Your AI agent. Your device. Your rules.
Local-first, runs anywhere (Desktop, server, Raspberry Pi, later mobile).

This implies: platform-specific paths matter. Data should go in the right place on each platform.

---

## Phase 2: Research — Exemplary Projects

### bat (sharkdp)
Uses etcetera crate for platform directories. Handles:
- Linux: XDG_DATA_HOME or ~/.local/share
- macOS: ~/Library/Application Support
- Windows: FOLDERID_RoamingAppData

### ripgrep (BurntSushi)
Uses dirs crate for similar purposes.

### Key insight:
Platform directory handling is a solved problem. Do not reinvent it.

---

## Phase 3: Bosun Analysis

### Issue Found: Incorrect macOS Data Directory

In crates/cli/src/main.rs, the dirs_data_dir() function uses:
~/.local/share/bosun on macOS

**Problem:** Uses Linux XDG convention on macOS.

**Correct macOS location:** ~/Library/Application Support/bosun

This matters because:
1. macOS users expect app data in Application Support
2. .local/share is non-standard on macOS
3. Time Machine and iCloud handle Application Support specially
4. System tools (like Finder) know about Application Support

### Additional issues:
- 40+ lines of platform-specific code that could be 2 lines with dirs crate
- Edge cases not handled (what if HOME is not set? WSL quirks?)

---

## Phase 4: Implementation Plan

**Chosen improvement:** Replace hand-rolled dirs_data_dir() with dirs crate

### Changes:
1. Add dirs to CLI dependencies
2. Replace dirs_data_dir() with dirs::data_dir()
3. Keep the same fallback behavior (.bosun if no data dir found)

### Why this matters:
- Fixes real bug on macOS
- Removes 40 lines of platform-specific code
- Uses battle-tested library (used by cargo, rustup, etc.)
- Better edge case handling

### Inspired by:
- bat use of etcetera
- ripgrep use of dirs
- STYLE.md: YAGNI (do not reinvent solved problems)

---

## Phase 5: Complete

**PR:** https://github.com/AustinEral/bosun/pull/23

**Session end:** 12:52 UTC
**Duration:** ~5 minutes

## Summary

Fixed incorrect macOS data directory handling:
1. Replaced hand-rolled dirs_data_dir() with dirs crate
2. macOS now correctly uses ~/Library/Application Support/bosun
3. Removed 22 lines of platform-specific code
4. Added proper documentation for the data_dir() function
